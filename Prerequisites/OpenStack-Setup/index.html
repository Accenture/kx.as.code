
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="KX.AS.CODE">
      
      
        <meta name="author" content="Patrick Delamere">
      
      
        <link rel="canonical" href="https://accenture.github.io/kx.as.code/Prerequisites/OpenStack-Setup/">
      
      
        <link rel="prev" href="../../Development/Testing/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Setting up DevStack - KX.AS.CODE</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=arial,+sans-serif:300,300i,400,400i,700,700i%7Cmonospace:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"arial, sans-serif";--md-code-font:"monospace"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setting-up-devstack" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KX.AS.CODE" class="md-header__button md-logo" aria-label="KX.AS.CODE" data-md-component="logo">
      
  <img src="../../assets/images/kxascode_white_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KX.AS.CODE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Setting up DevStack
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Accenture/kx.as.code" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KX.AS.CODE" class="md-nav__button md-logo" aria-label="KX.AS.CODE" data-md-component="logo">
      
  <img src="../../assets/images/kxascode_white_logo.png" alt="logo">

    </a>
    KX.AS.CODE
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Accenture/kx.as.code" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome!
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Quick-Start-Guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Overview
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Application-Library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Library
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Future-Roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Questions-and-Answers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Questions and Answers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Raising-a-Bug-Report/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Raising a Bug Report
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Raising-a-Feature-Request/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Raising a Feature Request
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Orchestrators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Orchestrators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/IAM-and-SSO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IAM and SSO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Task-Executions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task Executions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/Use-Case-Example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use Case Example
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Build
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Build
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Build/Local-Virtualizations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local Virtualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Build/Raspberry-Pi-Cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Raspberry Pi Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Build/Private-Clouds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private Clouds
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Build/Public-Clouds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Public Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Configuration-Options/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Customizing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customizing KX.AS.CODE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Deployment-Profiles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment Profiles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/External-Application-Access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External Application Access
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Initial-Setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initialize Launcher
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Local-Virtualizations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local Virtualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Raspberry-Pi-Cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Raspberry Pi Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Manual-Provisioning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manual Provisioning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Minimal-Deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minimal Deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Private-Clouds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Provisioning-Flow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation Flow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Provisioning-Templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Public-Clouds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Public Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Remote-Access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remote Access
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/Troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Deployment/User-Management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Management
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Development/Adding-a-Solution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adding a Solution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Development/Best-Practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Best Practices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Development/Central-Functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Central Functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Development/Contribution-Guidelines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Development/Debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Development/Releasing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Releasing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Development/Solution-Metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solution Metadata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Development/Testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Prerequisites
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Prerequisites
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Setting up DevStack
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Setting up DevStack
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-dev-stack-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Dev-Stack setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-points-on-networking" class="md-nav__link">
    <span class="md-ellipsis">
      General Points on Networking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-localconf" class="md-nav__link">
    <span class="md-ellipsis">
      Update local.conf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-etcsysctlconf" class="md-nav__link">
    <span class="md-ellipsis">
      Update /etc/sysctl.conf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-additional-net-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Install additional net-tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fix-incpython-file" class="md-nav__link">
    <span class="md-ellipsis">
      Fix inc/python file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fix-neutron_pluginsovn_agent-file" class="md-nav__link">
    <span class="md-ellipsis">
      Fix neutron_plugins/ovn_agent file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-arping-fix" class="md-nav__link">
    <span class="md-ellipsis">
      Install arping fix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-stack-data-mount" class="md-nav__link">
    <span class="md-ellipsis">
      Setup Stack Data Mount
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup Stack Data Mount">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#virtual-stack-volume-file" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual Stack Volume file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physical-drives" class="md-nav__link">
    <span class="md-ellipsis">
      Physical Drives
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-nova-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Update nova settings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-authentication-for-cli" class="md-nav__link">
    <span class="md-ellipsis">
      Set authentication for CLI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-devstack-storage-file" class="md-nav__link">
    <span class="md-ellipsis">
      Setup DevStack Storage file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-limits" class="md-nav__link">
    <span class="md-ellipsis">
      Set Limits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-default-security-group" class="md-nav__link">
    <span class="md-ellipsis">
      Update default security group
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-router" class="md-nav__link">
    <span class="md-ellipsis">
      Create Router
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-dns-to-network" class="md-nav__link">
    <span class="md-ellipsis">
      Add DNS to Network
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-image-upload-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Image Upload (Optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-ssh-key" class="md-nav__link">
    <span class="md-ellipsis">
      Create SSH Key
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-packer-image" class="md-nav__link">
    <span class="md-ellipsis">
      Build Packer Image
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build Packer Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kx-main" class="md-nav__link">
    <span class="md-ellipsis">
      KX-Main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kx-node" class="md-nav__link">
    <span class="md-ellipsis">
      KX-Node
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resetting-your-openstack-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Resetting your OpenStack environment
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-dev-stack-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Dev-Stack setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-points-on-networking" class="md-nav__link">
    <span class="md-ellipsis">
      General Points on Networking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-localconf" class="md-nav__link">
    <span class="md-ellipsis">
      Update local.conf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-etcsysctlconf" class="md-nav__link">
    <span class="md-ellipsis">
      Update /etc/sysctl.conf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-additional-net-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Install additional net-tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fix-incpython-file" class="md-nav__link">
    <span class="md-ellipsis">
      Fix inc/python file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fix-neutron_pluginsovn_agent-file" class="md-nav__link">
    <span class="md-ellipsis">
      Fix neutron_plugins/ovn_agent file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-arping-fix" class="md-nav__link">
    <span class="md-ellipsis">
      Install arping fix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-stack-data-mount" class="md-nav__link">
    <span class="md-ellipsis">
      Setup Stack Data Mount
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup Stack Data Mount">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#virtual-stack-volume-file" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual Stack Volume file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physical-drives" class="md-nav__link">
    <span class="md-ellipsis">
      Physical Drives
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-nova-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Update nova settings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-authentication-for-cli" class="md-nav__link">
    <span class="md-ellipsis">
      Set authentication for CLI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-devstack-storage-file" class="md-nav__link">
    <span class="md-ellipsis">
      Setup DevStack Storage file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-limits" class="md-nav__link">
    <span class="md-ellipsis">
      Set Limits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-default-security-group" class="md-nav__link">
    <span class="md-ellipsis">
      Update default security group
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-router" class="md-nav__link">
    <span class="md-ellipsis">
      Create Router
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-dns-to-network" class="md-nav__link">
    <span class="md-ellipsis">
      Add DNS to Network
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-image-upload-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Image Upload (Optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-ssh-key" class="md-nav__link">
    <span class="md-ellipsis">
      Create SSH Key
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-packer-image" class="md-nav__link">
    <span class="md-ellipsis">
      Build Packer Image
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build Packer Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kx-main" class="md-nav__link">
    <span class="md-ellipsis">
      KX-Main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kx-node" class="md-nav__link">
    <span class="md-ellipsis">
      KX-Node
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resetting-your-openstack-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Resetting your OpenStack environment
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="setting-up-devstack">Setting up DevStack<a class="headerlink" href="#setting-up-devstack" title="Permanent link">#</a></h1>
<p>If you would like to deploy KX.AS.CODE to OpenStack, but don't have an environment, follow the guide below to set up our own test environment.</p>
<h2 id="initial-dev-stack-setup">Initial Dev-Stack setup<a class="headerlink" href="#initial-dev-stack-setup" title="Permanent link">#</a></h2>
<p>For detailed instructions for setting up DevStack, see the following <a href="https://docs.openstack.org/devstack/latest/">guide</a></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>At the time of writing, Ubuntu 20.04 is the most tested operating system used with DevStack. The instructions here assume you are using that distribution.</p>
</div>
<p>Here a short summary of the link provided above.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>useradd<span class="w"> </span>-s<span class="w"> </span>/bin/bash<span class="w"> </span>-d<span class="w"> </span>/opt/stack<span class="w"> </span>-m<span class="w"> </span>stack
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;stack ALL=(ALL) NOPASSWD: ALL&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/sudoers.d/stack
sudo<span class="w"> </span>-u<span class="w"> </span>stack<span class="w"> </span>-i
git<span class="w"> </span>clone<span class="w"> </span>https://opendev.org/openstack/devstack
<span class="nb">cd</span><span class="w"> </span>devstack
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Don't run <code>./stack.sh</code> until you have completed further steps below</p>
</div>
<h2 id="general-points-on-networking">General Points on Networking<a class="headerlink" href="#general-points-on-networking" title="Permanent link">#</a></h2>
<p>It is recommended to have an additional NIC dedicated to the OpenStack public interface. In the example below, that is <code>eth1</code>.
You will need to enable promiscuous mode on that interface. Follow the instructions if using a virtual machine on how to enable that for your virtual network, otherwise, for a physical NIC you can do the following and reboot:
<code>sudo ip link set eth1 promisc on</code></p>
<h2 id="update-localconf">Update local.conf<a class="headerlink" href="#update-localconf" title="Permanent link">#</a></h2>
<p>Here the shorted version without all the comments:</p>
<pre><code>ADMIN_PASSWORD=<b><i>[enter your desired OpenStack admin password here]</i></b>
DATABASE_PASSWORD=$ADMIN_PASSWORD
RABBIT_PASSWORD=$ADMIN_PASSWORD
SERVICE_PASSWORD=$ADMIN_PASSWORD

VOLUME_GROUP_NAME="stack-volumes"
VOLUME_GROUP="stack-volumes"

<code style="color: rgb(0 0 0 / 54%); font-size: 1em;"># Uncomment below line if using an LVM with physical drives as a DevStack storage volume
#CINDER_ENABLED_BACKENDS=lvm

# Uncomment below lines if using a local file as a DevStack storage volume
#VOLUME_NAME_PREFIX="volume-"
#VOLUME_BACKING_FILE_SIZE=1500G
</code>
GLANCE_LIMIT_IMAGE_SIZE_TOTAL=100000
IMAGE_URLS="http://cdimage.debian.org/cdimage/openstack/current-10/debian-10-openstack-amd64.qcow2,https://cdimage.debian.org/cdimage/cloud/bullseye/latest/debian-11-generic-amd64.qcow2,"
LIBVIRT_TYPE=kvm
PUBLIC_INTERFACE=eth1  # change this to match the NIC you allocated to DevStack
HOST_IP=192.200.76.201  # In our test setup this matches the IP of the PUBLIC_INTERFACE defined above
LOGFILE=$DEST/logs/stack.sh.log
LOGDAYS=2
LOG_COLOR=True
VERBOSE=True
SWIFT_HASH=66a3d6b56c1f479c8b4e70ab5c2000f5
SWIFT_REPLICAS=1
SWIFT_DATA_DIR=$DEST/data
</code>
</pre>

<h2 id="update-etcsysctlconf">Update /etc/sysctl.conf<a class="headerlink" href="#update-etcsysctlconf" title="Permanent link">#</a></h2>
<p>Depending on your NIC names, and the NIC you intend to use for the DevStack public interface, set the following (in the example below, the public interface is <code>eth1</code>):</p>
<div class="highlight"><pre><span></span><code>net.ipv4.conf.default.rp_filter<span class="o">=</span><span class="m">0</span>
net.ipv4.conf.all.rp_filter<span class="o">=</span><span class="m">0</span>
net.ipv4.ip_forward<span class="o">=</span><span class="m">1</span>
net.ipv4.conf.eth1.proxy_arp<span class="o">=</span><span class="m">1</span>
net.ipv6.conf.all.forwarding<span class="o">=</span><span class="m">1</span>
</code></pre></div>
<h2 id="install-additional-net-tools">Install additional net-tools<a class="headerlink" href="#install-additional-net-tools" title="Permanent link">#</a></h2>
<p><code>apt install bridge-utils net-tools</code></p>
<h2 id="fix-incpython-file">Fix inc/python file<a class="headerlink" href="#fix-incpython-file" title="Permanent link">#</a></h2>
<p>To fix a dependency error when running <code>stack.sh</code>, it is necessary to do a minor fix</p>
<p>Open <code>/opt/stack/devstack/inc/python</code> and edit line <code>198</code>
Add <code>--ignore-installed</code> to line <code>198</code>, so it is changed to</p>
<p><code>$cmd_pip $upgrade --ignore-installed \</code></p>
<h2 id="fix-neutron_pluginsovn_agent-file">Fix neutron_plugins/ovn_agent file<a class="headerlink" href="#fix-neutron_pluginsovn_agent-file" title="Permanent link">#</a></h2>
<p>The next fix solves an error during <code>stack.sh</code> execution with <code>ovn</code>.</p>
<p>Open <code>/opt/stack/devstack/lib/neutron_plugins/ovn_agent</code> and edit line <code>114</code></p>
<p>Change</p>
<p><code>OVS_RUNDIR=$OVS_PREFIX/var/run/openvswitch</code></p>
<p>to</p>
<p><code>OVS_RUNDIR=$OVS_PREFIX/var/run/ovn</code></p>
<h2 id="install-arping-fix">Install arping fix<a class="headerlink" href="#install-arping-fix" title="Permanent link">#</a></h2>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>http://de.archive.ubuntu.com/ubuntu/pool/main/i/iputils/iputils-arping_20210202-1_amd64.deb
apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>./iputils-arping_20210202-1_amd64.deb
</code></pre></div>
<h2 id="setup-stack-data-mount">Setup Stack Data Mount<a class="headerlink" href="#setup-stack-data-mount" title="Permanent link">#</a></h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>There are a few ways to provide storage to your DevStack install. Through a logical volume mount with phyisical drives (virtual drives if not on bare metal), or a volume file. Both are described below. Follow one of the two guides depending on your setup.</p>
</div>
<h3 id="virtual-stack-volume-file">Virtual Stack Volume file<a class="headerlink" href="#virtual-stack-volume-file" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>losetup<span class="w"> </span>-f<span class="w"> </span>/opt/stack/data/stack-volumes-lvmdriver-1-backing-file
sudo<span class="w"> </span>losetup<span class="w"> </span>-f<span class="w"> </span>--show<span class="w"> </span>/opt/stack/data/stack-volumes-lvmdriver-1-backing-file
sudo<span class="w"> </span>vgcreate<span class="w"> </span>stack-volumes-lvmdriver-1<span class="w"> </span>/dev/loop9<span class="w">  </span><span class="c1"># use the output from the --show command above to determine which /dev/loop device to use</span>

vi<span class="w"> </span>/etc/lvm/lvm.conf
<span class="nv">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;a/loop9/&quot;</span>,<span class="w"> </span><span class="s2">&quot;r/.*/&quot;</span><span class="o">]</span><span class="w">   </span><span class="c1"># should be the loop device identified above</span>
</code></pre></div>
<h3 id="physical-drives">Physical Drives<a class="headerlink" href="#physical-drives" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code>vgremove<span class="w"> </span>stack-volumes
vgcreate<span class="w"> </span>stack-volumes<span class="w"> </span>/dev/nvme0n1<span class="w"> </span>/dev/nvme1n1<span class="w"> </span><span class="c1"># change to match the name of your physical drives</span>

vi<span class="w"> </span>/etc/lvm/lvm.conf
<span class="nv">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;a/nvme0n1/&quot;</span>,<span class="w"> </span><span class="s2">&quot;a/nvme1n1/&quot;</span>,<span class="w"> </span><span class="s2">&quot;r/.*/&quot;</span><span class="o">]</span><span class="w"> </span><span class="c1"># change to match the name of your physical drives</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Once you have completed all the above, you are ready to launch <code>./stack.sh</code>. Once done, you can proceed to the next steps below</p>
</div>
<h2 id="update-nova-settings">Update nova settings<a class="headerlink" href="#update-nova-settings" title="Permanent link">#</a></h2>
<p>In order to avoid timeout issues (default is 3 minutes) creating block devices, update the nova.conf file as follows:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>DEFAULT<span class="o">]</span>
..
..
<span class="nv">block_device_allocate_retries</span><span class="o">=</span><span class="m">600</span>
<span class="nv">block_device_allocate_retries_interval</span><span class="o">=</span><span class="m">3</span>
</code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Important</p>
<p>Not updating this setting will result in the following error message when provisioning VMs in OpenStack with large block storage: <code>[Error: Build of instance 5c7eb729-03c6-489f-899c-c748416ca6ae aborted: Volume 71169a26-ec13-4fa6-b14c-ce66560a7d45 did not finish being created even after we waited 184 seconds or 61 attempts. And its status is downloading.]</code></p>
</div>
<h2 id="set-authentication-for-cli">Set authentication for CLI<a class="headerlink" href="#set-authentication-for-cli" title="Permanent link">#</a></h2>
<p>Execute the following before executing any <code>openstack</code> commands, else they will fail with an unauthorized message.</p>
<div class="highlight"><pre><span></span><code>.<span class="w"> </span>/opt/stack/devstack/openrc<span class="w"> </span>admin
<span class="nb">export</span><span class="w"> </span><span class="nv">OS_AUTH_TOKEN</span><span class="o">=</span><span class="k">$(</span>openstack<span class="w"> </span>token<span class="w"> </span>issue<span class="w"> </span>-c<span class="w"> </span>id<span class="w"> </span>-f<span class="w"> </span>value<span class="k">)</span>
<span class="nb">unset</span><span class="w"> </span>OS_USERNAME
<span class="nb">unset</span><span class="w"> </span>OS_PASSWORD
<span class="nb">unset</span><span class="w"> </span>OS_PROJECT_DOMAIN_ID
<span class="nb">unset</span><span class="w"> </span>OS_PROJECT_DOMAIN_NAME
<span class="nb">unset</span><span class="w"> </span>OS_USER_DOMAIN_NAME
</code></pre></div>
<h2 id="setup-devstack-storage-file">Setup DevStack Storage file<a class="headerlink" href="#setup-devstack-storage-file" title="Permanent link">#</a></h2>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>losetup<span class="w"> </span>-f<span class="w"> </span>/opt/stack/data/stack-volumes-lvmdriver-1-backing-file
sudo<span class="w"> </span>losetup<span class="w"> </span>-f<span class="w"> </span>--show<span class="w"> </span>/opt/stack/data/stack-volumes-lvmdriver-1-backing-file
sudo<span class="w"> </span>vgcreate<span class="w"> </span>stack-volumes-lvmdriver-1<span class="w"> </span>/dev/loop9

sudo<span class="w"> </span>vi<span class="w"> </span>/etc/lvm/lvm.conf
<span class="nv">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;a/sdb/&quot;</span>,<span class="w"> </span><span class="s2">&quot;a/sdc/&quot;</span>,<span class="w"> </span><span class="s2">&quot;a/loop9/&quot;</span>,<span class="w"> </span><span class="s2">&quot;r/.*/&quot;</span><span class="o">]</span>

<span class="c1"># Restart OpenStack</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>devstack@*

<span class="c1"># Check if OpenStack volume service is now up</span>
openstack<span class="w"> </span>volume<span class="w"> </span>service<span class="w"> </span>list

<span class="c1"># Expected result output</span>
+------------------+----------------+------+---------+-------+----------------------------+
<span class="p">|</span><span class="w"> </span>Binary<span class="w">           </span><span class="p">|</span><span class="w"> </span>Host<span class="w">           </span><span class="p">|</span><span class="w"> </span>Zone<span class="w"> </span><span class="p">|</span><span class="w"> </span>Status<span class="w">  </span><span class="p">|</span><span class="w"> </span>State<span class="w"> </span><span class="p">|</span><span class="w"> </span>Updated<span class="w"> </span>At<span class="w">                 </span><span class="p">|</span>
+------------------+----------------+------+---------+-------+----------------------------+
<span class="p">|</span><span class="w"> </span>cinder-scheduler<span class="w"> </span><span class="p">|</span><span class="w"> </span>os<span class="w">             </span><span class="p">|</span><span class="w"> </span>nova<span class="w"> </span><span class="p">|</span><span class="w"> </span>enabled<span class="w"> </span><span class="p">|</span><span class="w"> </span>up<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">2022</span>-02-27T14:06:51.000000<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>cinder-volume<span class="w">    </span><span class="p">|</span><span class="w"> </span>os@lvmdriver-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>nova<span class="w"> </span><span class="p">|</span><span class="w"> </span>enabled<span class="w"> </span><span class="p">|</span><span class="w"> </span>up<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">2022</span>-02-27T14:06:52.000000<span class="w"> </span><span class="p">|</span>
+------------------+----------------+------+---------+-------+----------------------------+
</code></pre></div>
<h2 id="set-limits">Set Limits<a class="headerlink" href="#set-limits" title="Permanent link">#</a></h2>
<p>This is optional, but recommended. Not setting these to higher limits may result in errors when deploying KX.AS.CODE to OpenStack due to limited resouces.</p>
<div class="highlight"><pre><span></span><code>openstack<span class="w"> </span>quota<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--volumes<span class="w"> </span><span class="m">30</span><span class="w"> </span>admin
openstack<span class="w"> </span>quota<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--gigabytes<span class="w"> </span><span class="m">1700</span><span class="w"> </span>admin
openstack<span class="w"> </span>quota<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--snapshots<span class="w"> </span><span class="m">30</span><span class="w"> </span>admin
</code></pre></div>
<h2 id="update-default-security-group">Update default security group<a class="headerlink" href="#update-default-security-group" title="Permanent link">#</a></h2>
<p>Update the security rules to enable SSH to the KX.AS.CODE virtual machines.</p>
<div class="highlight"><pre><span></span><code>openstack<span class="w"> </span>security<span class="w"> </span>group<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span>--proto<span class="w"> </span>icmp<span class="w"> </span>--dst-port<span class="w"> </span><span class="m">0</span><span class="w"> </span>default
openstack<span class="w"> </span>security<span class="w"> </span>group<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span>--proto<span class="w"> </span>tcp<span class="w"> </span>--dst-port<span class="w"> </span><span class="m">22</span><span class="w"> </span>default
</code></pre></div>
<p>In the standard DevStack installation there are two security groups with the name "default". In this case it is necessary to use the project and security group IDs to identifythe correct group to update.
You can get the IDs using the following:</p>
<div class="highlight"><pre><span></span><code>openstack<span class="w"> </span>project<span class="w"> </span>list
openstack<span class="w"> </span>security<span class="w"> </span>group<span class="w"> </span>list
</code></pre></div>
<p>Once obtained, insert the values as per the below:</p>
<div class="highlight"><pre><span></span><code>openstack<span class="w"> </span>security<span class="w"> </span>group<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span>--project<span class="w"> </span>&lt;project_id&gt;<span class="w"> </span>--proto<span class="w"> </span>icmp<span class="w"> </span>--dst-port<span class="w"> </span><span class="m">0</span><span class="w"> </span>&lt;default<span class="w"> </span>security_group_id&gt;
openstack<span class="w"> </span>security<span class="w"> </span>group<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span>--project<span class="w"> </span>&lt;project_id&gt;<span class="w"> </span>--proto<span class="w"> </span>tcp<span class="w"> </span>--dst-port<span class="w"> </span><span class="m">22</span><span class="w"> </span>&lt;default<span class="w"> </span>security_group_id&gt;
</code></pre></div>
<h2 id="create-router">Create Router<a class="headerlink" href="#create-router" title="Permanent link">#</a></h2>
<div class="highlight"><pre><span></span><code>openstack<span class="w"> </span>router<span class="w"> </span>create<span class="w"> </span>--project<span class="w"> </span>admin<span class="w"> </span>--enable<span class="w"> </span>public
openstack<span class="w"> </span>router<span class="w"> </span>add<span class="w"> </span>subnet<span class="w"> </span>public<span class="w"> </span>shared-subnet
openstack<span class="w"> </span>router<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--enable-snat<span class="w"> </span>--external-gateway<span class="w"> </span>public<span class="w"> </span>public
openstack<span class="w"> </span>router<span class="w"> </span>show<span class="w"> </span>public
</code></pre></div>
<h2 id="add-dns-to-network">Add DNS to Network<a class="headerlink" href="#add-dns-to-network" title="Permanent link">#</a></h2>
<div class="highlight"><pre><span></span><code>openstack<span class="w"> </span>subnet<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--dns-nameserver<span class="w"> </span><span class="m">8</span>.8.8.8<span class="w">  </span>--dns-nameserver<span class="w"> </span><span class="m">8</span>.8.4.4<span class="w"> </span>--dns-nameserver<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w"> </span>shared-subnet
</code></pre></div>
<h2 id="manual-image-upload-optional">Manual Image Upload (Optional)<a class="headerlink" href="#manual-image-upload-optional" title="Permanent link">#</a></h2>
<p>This is an optional step in case you want to upload more images to OpenStack.
Debian 10 and Debian 11 base images should have been uploaded already when you ran <code>stack.sh</code>, as we included it in <code>local.conf</code> above.</p>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://cdimage.debian.org/cdimage/cloud/bullseye/latest/debian-11-generic-amd64.qcow2

openstack<span class="w"> </span>image<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--container-format<span class="w"> </span>bare<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--disk-format<span class="w"> </span>qcow2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--file<span class="w">  </span>debian-11-generic-amd64.qcow2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>debian-11-openstack-amd64
</code></pre></div>
<h2 id="create-ssh-key">Create SSH Key<a class="headerlink" href="#create-ssh-key" title="Permanent link">#</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Creating the SSH key will make it easy to enter the VM for debugging a failed build</p>
</div>
<div class="highlight"><pre><span></span><code>openstack<span class="w"> </span>keypair<span class="w"> </span>create<span class="w"> </span>--public-key<span class="w"> </span>~/.ssh/id_rsa.pub<span class="w"> </span>packer-build
</code></pre></div>
<h2 id="build-packer-image">Build Packer Image<a class="headerlink" href="#build-packer-image" title="Permanent link">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note, the value for <code>openstack_networks</code> must be the private network (named "shared" or "private" in the default DevStack setup), and not the public one.</p>
</div>
<p>In order to build KX.AS.CODE, you can now run the following commands.</p>
<h3 id="kx-main">KX-Main<a class="headerlink" href="#kx-main" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code>packer<span class="w"> </span>build<span class="w"> </span>-force<span class="w"> </span>-only<span class="w"> </span>kx.as.code-main-openstack<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">compute_engine_build</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">hostname</span><span class="o">=</span>kx-main<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">domain</span><span class="o">=</span>kx-as-code.local<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="m">0</span>.8.6<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">kube_version</span><span class="o">=</span><span class="m">1</span>.21.3-00<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">vm_user</span><span class="o">=</span>kx.hero<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">vm_password</span><span class="o">=</span>L3arnandshare<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">git_source_url</span><span class="o">=</span>https://github.com/Accenture/kx.as.code.git<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">git_source_branch</span><span class="o">=</span>main<span class="w"> </span><span class="se">\ </span><span class="w"> </span><span class="c1"># KX.AS.CODE branch to check out inside VM</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">git_source_user</span><span class="o">=</span>********<span class="w"> </span><span class="se">\ </span><span class="c1"># optional, not needed for public Git repository</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">git_source_token</span><span class="o">=</span>*******<span class="w"> </span><span class="se">\ </span><span class="w"> </span><span class="c1"># optional, not needed for public Git repository</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">base_image_ssh_user</span><span class="o">=</span>debian<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_auth_url</span><span class="o">=</span>http://192.200.76.201/identity/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_user</span><span class="o">=</span>admin<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_password</span><span class="o">=</span>&lt;enter<span class="w"> </span>OpenStack<span class="w"> </span>password<span class="w"> </span><span class="nb">set</span><span class="w"> </span>during<span class="w"> </span>OpenStack<span class="w"> </span>install&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_region</span><span class="o">=</span>RegionOne<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_networks</span><span class="o">=</span>&lt;enter<span class="w"> </span>private<span class="w"> </span>network<span class="w"> </span>ID<span class="w"> </span>here&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_floating_ip_network</span><span class="o">=</span>public<span class="w"> </span><span class="se">\ </span><span class="w"> </span><span class="c1"># change if your public network with a gateway is named differently</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_source_image</span><span class="o">=</span>&lt;add<span class="w"> </span><span class="nb">source</span><span class="w"> </span>image<span class="w"> </span>ID<span class="w"> </span><span class="k">for</span><span class="w"> </span>Debian<span class="w"> </span><span class="m">11</span><span class="w"> </span>here&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_flavor</span><span class="o">=</span>m1.medium<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_security_groups</span><span class="o">=</span>default<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">ssh_keypair_name</span><span class="o">=</span>packer-build<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>./kx-main-cloud-profiles.json
</code></pre></div>
<h3 id="kx-node">KX-Node<a class="headerlink" href="#kx-node" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code>packer<span class="w"> </span>build<span class="w"> </span>-force<span class="w"> </span>-only<span class="w"> </span>kx.as.code-node-openstack<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">compute_engine_build</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">hostname</span><span class="o">=</span>kx-node<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">domain</span><span class="o">=</span>kx-as-code.local<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="m">0</span>.8.6<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">kube_version</span><span class="o">=</span><span class="m">1</span>.21.3-00<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">vm_user</span><span class="o">=</span>kx.hero<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">vm_password</span><span class="o">=</span>L3arnandshare<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">git_source_url</span><span class="o">=</span>https://github.com/Accenture/kx.as.code.git<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">git_source_branch</span><span class="o">=</span>main<span class="w"> </span><span class="se">\ </span><span class="w"> </span><span class="c1"># KX.AS.CODE branch to check out inside VM</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">git_source_user</span><span class="o">=</span>********<span class="w"> </span><span class="se">\ </span><span class="c1"># optional, not needed for public Git repository</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">git_source_token</span><span class="o">=</span>*******<span class="w"> </span><span class="se">\ </span><span class="w"> </span><span class="c1"># optional, not needed for public Git repository</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">base_image_ssh_user</span><span class="o">=</span>debian<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_auth_url</span><span class="o">=</span>http://192.200.76.201/identity/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_user</span><span class="o">=</span>admin<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_password</span><span class="o">=</span>&lt;enter<span class="w"> </span>OpenStack<span class="w"> </span>password<span class="w"> </span><span class="nb">set</span><span class="w"> </span>during<span class="w"> </span>OpenStack<span class="w"> </span>install&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_region</span><span class="o">=</span>RegionOne<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_networks</span><span class="o">=</span>&lt;enter<span class="w"> </span>private<span class="w"> </span>network<span class="w"> </span>ID<span class="w"> </span>here&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_floating_ip_network</span><span class="o">=</span>public<span class="w"> </span><span class="se">\ </span><span class="w"> </span><span class="c1"># change if your public network with a gateway is named differently</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_source_image</span><span class="o">=</span>&lt;add<span class="w"> </span><span class="nb">source</span><span class="w"> </span>image<span class="w"> </span>ID<span class="w"> </span><span class="k">for</span><span class="w"> </span>Debian<span class="w"> </span><span class="m">11</span><span class="w"> </span>here&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_flavor</span><span class="o">=</span>m1.medium<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">openstack_security_groups</span><span class="o">=</span>default<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="w"> </span><span class="nv">ssh_keypair_name</span><span class="o">=</span>packer-build<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>./kx-node-cloud-profiles.json

<span class="c1">## Restarting OpenStack in case of issues</span>
<span class="sb">```</span>bash
<span class="c1"># Optionally restart network if connectivity issues start appearing, such as DNS timeout etc</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>systemd-networkd

<span class="c1"># Restarting DevStack</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>devstack@*
</code></pre></div>
<h2 id="resetting-your-openstack-environment">Resetting your OpenStack environment<a class="headerlink" href="#resetting-your-openstack-environment" title="Permanent link">#</a></h2>
<p>If you have any issues with your OpenStack installation (this could happen after a reboot for example), then you can do the following to reset it.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>su<span class="w"> </span>stack
<span class="nb">cd</span><span class="w"> </span>/opt/stack/devstack
./clean.sh
./unstack.sh
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/run/ovn
sudo<span class="w"> </span>reboot
</code></pre></div>
<p>Once you have completed the steps and rebooted, just go back to <code>/opt/stack/devstack</code> as the stack user and run <code>./stack.sh</code> again. Afterwards you will again need to run the post steps again, such as reinitializing the volume file, updating <code>nova.conf</code> and applying the increased limits again etc.
You can either do it manually by repeating the steps after <code>stack.sh</code> above, or using the script below.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Add cinder options to prevent provisioning timeout (not really working)</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/etc/nova/nova.conf<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;block_device_allocate_retries&quot;</span><span class="k">)</span><span class="w"> </span>-le<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/^\[DEFAULT\]/a block_device_allocate_retries=600\nblock_device_allocate_retries_interval=3&#39;</span><span class="w"> </span>/etc/nova/nova.conf
<span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;No change to nova.conf needed&quot;</span>
<span class="k">fi</span>

<span class="c1"># Setup virtual volume (not needed if using an LVM with physical volumes)</span>
sudo<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/opt/stack/data/stack-volumes-lvmdriver-1-backing-file
sudo<span class="w"> </span>truncate<span class="w"> </span>-s<span class="w"> </span>1500G<span class="w"> </span>/opt/stack/data/stack-volumes-lvmdriver-1-backing-file
sudo<span class="w"> </span>losetup<span class="w"> </span>-f<span class="w"> </span>/opt/stack/data/stack-volumes-lvmdriver-1-backing-file
<span class="nv">loopDevice</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="k">$(</span>sudo<span class="w"> </span>losetup<span class="w"> </span>-f<span class="w"> </span>--show<span class="w"> </span>/opt/stack/data/stack-volumes-lvmdriver-1-backing-file<span class="k">))</span>
sudo<span class="w"> </span>vgcreate<span class="w"> </span>stack-volumes-lvmdriver-1<span class="w"> </span>/dev/<span class="si">${</span><span class="nv">loopDevice</span><span class="si">}</span>

<span class="c1"># Correct loopback device in lvm.conf</span>
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s;\/loop.*[0-9]\/;\/&#39;</span><span class="si">${</span><span class="nv">loopDevice</span><span class="si">}</span><span class="s1">&#39;\/;g&#39;</span><span class="w"> </span>/etc/lvm/lvm.conf

<span class="c1"># Restart OpenStack</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>devstack@*

<span class="c1"># Get OpenStack token</span>
.<span class="w"> </span>/opt/stack/devstack/openrc<span class="w"> </span>admin
<span class="nb">export</span><span class="w"> </span><span class="nv">OS_AUTH_TOKEN</span><span class="o">=</span><span class="k">$(</span>openstack<span class="w"> </span>token<span class="w"> </span>issue<span class="w"> </span>-c<span class="w"> </span>id<span class="w"> </span>-f<span class="w"> </span>value<span class="k">)</span>

<span class="c1"># Check if OpenStack volume service is now up</span>
openstack<span class="w"> </span>volume<span class="w"> </span>service<span class="w"> </span>list

<span class="c1"># Set new limits</span>
openstack<span class="w"> </span>quota<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--volumes<span class="w"> </span><span class="m">30</span><span class="w"> </span>admin
openstack<span class="w"> </span>quota<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--gigabytes<span class="w"> </span><span class="m">1700</span><span class="w"> </span>admin
openstack<span class="w"> </span>quota<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--snapshots<span class="w"> </span><span class="m">30</span><span class="w"> </span>admin

<span class="c1"># Get project and security group ids</span>
openstack<span class="w"> </span>project<span class="w"> </span>list
openstack<span class="w"> </span>security<span class="w"> </span>group<span class="w"> </span>list
<span class="nv">projectId</span><span class="o">=</span><span class="k">$(</span>openstack<span class="w"> </span>project<span class="w"> </span>show<span class="w"> </span>admin<span class="w"> </span>-f<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nv">securityGroupId</span><span class="o">=</span><span class="k">$(</span>openstack<span class="w"> </span>security<span class="w"> </span>group<span class="w"> </span>list<span class="w"> </span>--project<span class="w"> </span><span class="si">${</span><span class="nv">projectId</span><span class="si">}</span><span class="w"> </span>-f<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.[] | select(.Name==&quot;default&quot;) | .ID&#39;</span><span class="k">)</span>

<span class="c1"># Add rules to admin project&#39;s default security group</span>
openstack<span class="w"> </span>security<span class="w"> </span>group<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span>--project<span class="w"> </span><span class="si">${</span><span class="nv">projectId</span><span class="si">}</span><span class="w"> </span>--proto<span class="w"> </span>icmp<span class="w"> </span>--dst-port<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="si">${</span><span class="nv">securityGroupId</span><span class="si">}</span>
openstack<span class="w"> </span>security<span class="w"> </span>group<span class="w"> </span>rule<span class="w"> </span>create<span class="w"> </span>--project<span class="w"> </span><span class="si">${</span><span class="nv">projectId</span><span class="si">}</span><span class="w"> </span>--proto<span class="w"> </span>tcp<span class="w"> </span>--dst-port<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="si">${</span><span class="nv">securityGroupId</span><span class="si">}</span>

<span class="c1"># Setup router</span>
openstack<span class="w"> </span>router<span class="w"> </span>create<span class="w"> </span>--project<span class="w"> </span>admin<span class="w"> </span>--enable<span class="w"> </span>public
openstack<span class="w"> </span>router<span class="w"> </span>add<span class="w"> </span>subnet<span class="w"> </span>public<span class="w"> </span>shared-subnet
openstack<span class="w"> </span>router<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--enable-snat<span class="w"> </span>--external-gateway<span class="w"> </span>public<span class="w"> </span>public
openstack<span class="w"> </span>router<span class="w"> </span>show<span class="w"> </span>public

<span class="c1"># Configure DNS</span>
openstack<span class="w"> </span>subnet<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--dns-nameserver<span class="w"> </span><span class="m">8</span>.8.8.8<span class="w">  </span>--dns-nameserver<span class="w"> </span><span class="m">8</span>.8.4.4<span class="w"> </span>--dns-nameserver<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w"> </span>shared-subnet
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "navigation.sections", "navigation.top", "navigation.tracking", "navigation.expand", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="../../assets/js/custom.js"></script>
      
    
  </body>
</html>